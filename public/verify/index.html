<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NVLP - Email Verified</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .container {
            text-align: center;
            padding: 2rem;
            max-width: 600px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            backdrop-filter: blur(10px);
        }
        .logo {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 1rem;
        }
        .success {
            font-size: 1.5rem;
            margin: 1rem 0;
            color: #4ade80;
        }
        .message {
            font-size: 1.1rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }
        .error {
            color: #ef4444;
            font-size: 1.2rem;
        }
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #4ade80;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 1rem auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .open-app-button {
            background: #4ade80;
            color: #000;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            margin: 1rem;
            transition: background 0.3s;
            text-decoration: none;
            display: inline-block;
        }
        .open-app-button:hover {
            background: #22c55e;
        }
        .instructions {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">NVLP</div>
        <div id="content">
            <div class="spinner"></div>
            <div class="message">Validating...</div>
        </div>
    </div>

    <script>
        function isMobileDevice() {
            return /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ||
                   (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1); // iPad Pro detection
        }

        function displayError(message) {
            const content = document.getElementById('content');
            content.innerHTML = `
                <div class="error">Authentication Failed</div>
                <div class="message">${message}</div>
            `;
        }

        function displaySuccess() {
            const content = document.getElementById('content');
            const isMobile = isMobileDevice();
            
            if (isMobile) {
                content.innerHTML = `
                    <div class="success">✓ Authentication Successful</div>
                    <div class="message">Opening NVLP app...</div>
                    <div class="instructions">If the app doesn't open automatically, tap the button below:</div>
                    <a href="nvlp://auth/callback${window.location.hash}" class="open-app-button">Open NVLP App</a>
                `;
            } else {
                content.innerHTML = `
                    <div class="success">✓ Authentication Successful</div>
                    <div class="message">Please open the NVLP app to continue</div>
                    <div class="instructions">Your authentication is complete. Switch to your mobile device and open the NVLP app to continue.</div>
                `;
            }
        }

        function processAuthentication() {
            // Extract data from URL
            const hash = window.location.hash.substring(1);
            const params = new URLSearchParams(hash);
            const error = params.get('error');
            const errorDescription = params.get('error_description');
            const accessToken = params.get('access_token');

            // Show validation state briefly
            setTimeout(() => {
                if (error) {
                    displayError(errorDescription || 'An error occurred during authentication');
                } else if (accessToken) {
                    displaySuccess();
                    
                    // On mobile, automatically try to launch the app after showing success
                    if (isMobileDevice()) {
                        setTimeout(() => {
                            const deepLinkUrl = `nvlp://auth/callback${window.location.hash}`;
                            window.location.href = deepLinkUrl;
                        }, 1500); // Wait 1.5 seconds to show success message
                    }
                } else {
                    displayError('No authentication data found. The link may be invalid or expired.');
                }
            }, 1000); // Show "Validating..." for 1 second
        }

        // Start the authentication process
        processAuthentication();
    </script>
</body>
</html>