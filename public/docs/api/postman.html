<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NVLP API - Postman Collection</title>
    <meta name="description" content="Download Postman collection for NVLP API testing">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/assets/IconOnly_Transparent_NoBuffer.png">
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            margin: 0;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .header img {
            height: 64px;
            margin-bottom: 1rem;
        }
        
        .header h1 {
            color: #333;
            margin: 0 0 0.5rem 0;
            font-size: 2.5rem;
        }
        
        .header p {
            color: #666;
            font-size: 1.1rem;
            margin: 0;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        
        .card h2 {
            color: #333;
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .icon {
            width: 24px;
            height: 24px;
        }
        
        .button {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            transition: transform 0.2s, box-shadow 0.2s;
            margin: 0.5rem 0.5rem 0.5rem 0;
        }
        
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(102, 126, 234, 0.3);
        }
        
        .button.secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }
        
        .button.secondary:hover {
            background: #667eea;
            color: white;
        }
        
        .instructions {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 1rem;
            border-radius: 0 8px 8px 0;
            margin: 1rem 0;
        }
        
        .instructions ol {
            margin: 0;
            padding-left: 1.5rem;
        }
        
        .instructions li {
            margin-bottom: 0.5rem;
        }
        
        code {
            background: #f1f3f4;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
            font-size: 0.9em;
        }
        
        .environment-vars {
            background: #263238;
            color: #ffffff;
            padding: 1rem;
            border-radius: 8px;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
            font-size: 0.9em;
            overflow-x: auto;
            margin: 1rem 0;
        }
        
        .nav-links {
            text-align: center;
            margin-top: 2rem;
        }
        
        .nav-links a {
            color: #667eea;
            text-decoration: none;
            margin: 0 1rem;
            font-weight: 500;
        }
        
        .nav-links a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="/assets/IconOnly_Transparent_NoBuffer.png" alt="NVLP Logo">
            <h1>Postman Collection</h1>
            <p>Test the NVLP API with ready-to-use Postman requests</p>
        </div>
        
        <div class="card">
            <h2>
                <span class="icon">üì¶</span>
                Download Collection
            </h2>
            <p>Get the complete NVLP API collection for Postman with pre-configured requests for all endpoints.</p>
            
            <a href="#" class="button" id="download-collection">Download Postman Collection</a>
            <a href="/docs/api" class="button secondary">View API Documentation</a>
            
            <div class="instructions">
                <strong>Quick Setup:</strong>
                <ol>
                    <li>Download the collection file above</li>
                    <li>Import it into Postman</li>
                    <li>Set up your environment variables (see below)</li>
                    <li>Start testing the API!</li>
                </ol>
            </div>
        </div>
        
        <div class="card">
            <h2>
                <span class="icon">‚öôÔ∏è</span>
                Environment Setup
            </h2>
            <p>Create a new environment in Postman with these variables:</p>
            
            <div class="environment-vars">
{
  "baseUrl": "https://your-project.supabase.co",
  "anonKey": "your_supabase_anon_key",
  "accessToken": "your_access_token_from_auth",
  "budgetId": "uuid_of_test_budget",
  "envelopeId": "uuid_of_test_envelope",
  "transactionId": "uuid_of_test_transaction"
}
            </div>
            
            <div class="instructions">
                <strong>Getting Your Access Token:</strong>
                <ol>
                    <li>Run the <code>Auth Flow</code> request in the collection</li>
                    <li>Check your email for the magic link</li>
                    <li>Click the link and extract the <code>access_token</code> from the URL</li>
                    <li>Update your environment variable</li>
                </ol>
            </div>
        </div>
        
        <div class="card">
            <h2>
                <span class="icon">üöÄ</span>
                Getting Started
            </h2>
            <p>Follow this workflow to test the complete API:</p>
            
            <div class="instructions">
                <ol>
                    <li><strong>Authentication:</strong> Send magic link ‚Üí Get access token</li>
                    <li><strong>Budget Setup:</strong> Create budget ‚Üí Add default objects (optional)</li>
                    <li><strong>Transactions:</strong> Create income ‚Üí Allocate to envelopes ‚Üí Make purchases</li>
                    <li><strong>Analysis:</strong> View dashboard ‚Üí Export data</li>
                </ol>
            </div>
            
            <p><em>The collection includes example requests for all major workflows and error scenarios.</em></p>
        </div>
        
        <div class="nav-links">
            <a href="/docs/api">‚Üê API Documentation</a>
            <a href="/">NVLP Home</a>
            <a href="https://github.com/nvlp-app" target="_blank">GitHub</a>
        </div>
    </div>
    
    <script>
        // Generate and download Postman collection
        document.getElementById('download-collection').addEventListener('click', function(e) {
            e.preventDefault();
            
            // Generate Postman collection JSON
            const collection = {
                "info": {
                    "name": "NVLP API",
                    "description": "Complete API collection for NVLP - Virtual Envelope Budgeting System",
                    "version": "1.0.0",
                    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
                },
                "auth": {
                    "type": "bearer",
                    "bearer": [
                        {
                            "key": "token",
                            "value": "{{accessToken}}",
                            "type": "string"
                        }
                    ]
                },
                "variable": [
                    {
                        "key": "baseUrl",
                        "value": "https://your-project.supabase.co",
                        "type": "string"
                    },
                    {
                        "key": "anonKey",
                        "value": "your_supabase_anon_key",
                        "type": "string"
                    }
                ],
                "item": [
                    {
                        "name": "Authentication",
                        "item": [
                            {
                                "name": "Send Magic Link",
                                "request": {
                                    "method": "POST",
                                    "header": [
                                        {
                                            "key": "Content-Type",
                                            "value": "application/json"
                                        }
                                    ],
                                    "auth": {
                                        "type": "bearer",
                                        "bearer": [
                                            {
                                                "key": "token",
                                                "value": "{{anonKey}}",
                                                "type": "string"
                                            }
                                        ]
                                    },
                                    "body": {
                                        "mode": "raw",
                                        "raw": JSON.stringify({
                                            "email": "test@example.com",
                                            "redirectTo": "https://nvlp.app/verify"
                                        }, null, 2)
                                    },
                                    "url": {
                                        "raw": "{{baseUrl}}/functions/v1/auth-magic-link",
                                        "host": ["{{baseUrl}}"],
                                        "path": ["functions", "v1", "auth-magic-link"]
                                    }
                                }
                            },
                            {
                                "name": "Get User Profile",
                                "request": {
                                    "method": "GET",
                                    "header": [],
                                    "url": {
                                        "raw": "{{baseUrl}}/functions/v1/auth-user",
                                        "host": ["{{baseUrl}}"],
                                        "path": ["functions", "v1", "auth-user"]
                                    }
                                }
                            }
                        ]
                    },
                    {
                        "name": "Budgets",
                        "item": [
                            {
                                "name": "List Budgets",
                                "request": {
                                    "method": "GET",
                                    "header": [
                                        {
                                            "key": "apikey",
                                            "value": "{{anonKey}}"
                                        }
                                    ],
                                    "url": {
                                        "raw": "{{baseUrl}}/rest/v1/budgets",
                                        "host": ["{{baseUrl}}"],
                                        "path": ["rest", "v1", "budgets"]
                                    }
                                }
                            },
                            {
                                "name": "Create Budget",
                                "request": {
                                    "method": "POST",
                                    "header": [
                                        {
                                            "key": "Content-Type",
                                            "value": "application/json"
                                        },
                                        {
                                            "key": "apikey",
                                            "value": "{{anonKey}}"
                                        },
                                        {
                                            "key": "Prefer",
                                            "value": "return=representation"
                                        }
                                    ],
                                    "body": {
                                        "mode": "raw",
                                        "raw": JSON.stringify({
                                            "name": "Test Budget",
                                            "description": "Budget created via Postman",
                                            "currency": "USD"
                                        }, null, 2)
                                    },
                                    "url": {
                                        "raw": "{{baseUrl}}/rest/v1/budgets",
                                        "host": ["{{baseUrl}}"],
                                        "path": ["rest", "v1", "budgets"]
                                    }
                                }
                            }
                        ]
                    },
                    {
                        "name": "Transactions",
                        "item": [
                            {
                                "name": "Create Income Transaction",
                                "request": {
                                    "method": "POST",
                                    "header": [
                                        {
                                            "key": "Content-Type",
                                            "value": "application/json"
                                        }
                                    ],
                                    "body": {
                                        "mode": "raw",
                                        "raw": JSON.stringify({
                                            "budget_id": "{{budgetId}}",
                                            "transaction_type": "income",
                                            "amount": 1000.00,
                                            "description": "Test income",
                                            "transaction_date": "2024-01-01",
                                            "income_source_id": "{{incomeSourceId}}"
                                        }, null, 2)
                                    },
                                    "url": {
                                        "raw": "{{baseUrl}}/functions/v1/transactions",
                                        "host": ["{{baseUrl}}"],
                                        "path": ["functions", "v1", "transactions"]
                                    }
                                }
                            }
                        ]
                    }
                ]
            };
            
            // Create and download the file
            const blob = new Blob([JSON.stringify(collection, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'NVLP-API-Collection.postman_collection.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });
    </script>
</body>
</html>